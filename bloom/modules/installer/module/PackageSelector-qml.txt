/* packageSelector.qml - QML interface for package group selection */

import QtQuick 2.15
import QtQuick.Controls 2.15
import QtQuick.Layouts 1.15
import calamares.slideshow 1.0

Item {
    id: root
    width: 800
    height: 500

    property var config: config
    property var viewdata: config.packageSelectorViewData || { groups: [] }
    property var selectedGroups: []

    Component.onCompleted: {
        // Add default package groups to selection
        viewdata.groups.forEach(function(group) {
            if (group.id === "office") {  // Office is selected by default
                selectedGroups.push(group.id);
            }
        });
    }

    Component.onDestruction: {
        // Save selected groups to global storage
        config.selectedPackageGroups = selectedGroups;
    }

    Rectangle {
        anchors.fill: parent
        color: "#F5F5F5"

        ColumnLayout {
            anchors.fill: parent
            anchors.margins: 20
            spacing: 10

            Label {
                Layout.fillWidth: true
                text: "Select Package Categories to Install"
                font.pixelSize: 24
                font.bold: true
                color: "#FF5F15"
            }

            Label {
                Layout.fillWidth: true
                text: "Choose the software categories you want to install. You can install additional packages later using the package manager."
                wrapMode: Text.WordWrap
                font.pixelSize: 14
                color: "#333333"
            }

            ScrollView {
                Layout.fillWidth: true
                Layout.fillHeight: true
                clip: true

                ListView {
                    id: packageGroupList
                    anchors.fill: parent
                    model: viewdata.groups
                    spacing: 10
                    
                    delegate: Rectangle {
                        width: packageGroupList.width
                        height: 100
                        radius: 5
                        border.color: modelData.id in selectedGroups ? "#FF5F15" : "#CCCCCC"
                        border.width: 2
                        color: modelData.id in selectedGroups ? "#FFF0E8" : "#FFFFFF"

                        MouseArea {
                            anchors.fill: parent
                            onClicked: {
                                var index = selectedGroups.indexOf(modelData.id);
                                if (index === -1) {
                                    selectedGroups.push(modelData.id);
                                } else {
                                    selectedGroups.splice(index, 1);
                                }
                                packageGroupList.model = packageGroupList.model;
                            }
                        }

                        RowLayout {
                            anchors.fill: parent
                            anchors.margins: 10
                            spacing: 10

                            Rectangle {
                                Layout.preferredWidth: 30
                                Layout.preferredHeight: 30
                                Layout.alignment: Qt.AlignVCenter
                                radius: 15
                                color: modelData.id in selectedGroups ? "#FF5F15" : "#FFFFFF"
                                border.color: "#CCCCCC"
                                border.width: 1

                                Text {
                                    anchors.centerIn: parent
                                    text: "âœ“"
                                    color: "#FFFFFF"
                                    font.pixelSize: 18
                                    visible: modelData.id in selectedGroups
                                }
                            }

                            ColumnLayout {
                                Layout.fillWidth: true
                                Layout.fillHeight: true
                                spacing: 5

                                Label {
                                    Layout.fillWidth: true
                                    text: modelData.name
                                    font.pixelSize: 18
                                    font.bold: true
                                    color: "#333333"
                                }

                                Label {
                                    Layout.fillWidth: true
                                    text: modelData.description
                                    wrapMode: Text.WordWrap
                                    font.pixelSize: 12
                                    color: "#666666"
                                }

                                Label {
                                    Layout.fillWidth: true
                                    text: "Packages: " + modelData.packages.join(", ")
                                    wrapMode: Text.WordWrap
                                    font.pixelSize: 10
                                    color: "#999999"
                                    elide: Text.ElideRight
                                    maximumLineCount: 1
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}
